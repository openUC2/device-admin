{{if .Data.IsStreamPage}}
  {{template "shared/stream-page.layout.tmpl" .}}
{{else}}
  {{template "shared/base.layout.tmpl" .}}
{{end}}

{{define "title"}}Internet Access{{end}}
{{define "description"}}Manage configurations for internet access{{end}}

{{define "content"}}
  {{
    template "shared/turbo-cable-stream-source.partial.tmpl" dict
    "Name" (print .Meta.BasePath "internet?mode=" (.Meta.Form.Get "mode"))
    "BasePath" .Meta.BasePath
  }}

  <main class="main-container" tabindex="-1" data-controller="default-scrollable">
    {{if ne (.Meta.Form.Get "nav") "hidden"}}
      <nav class="breadcrumb main-breadcrumb" aria-label="breadcrumbs">
        <ul>
          <li><a href="{{urlJoin (dict
            "path" .Meta.BasePath
            "query" .Meta.Form.Encode
          )}}">Admin</a></li>
          <li class="is-active"><a href="{{urlJoin (dict
            "path" .Meta.Path
            "query" .Meta.Form.Encode
          )}}" aria-current="page">Internet</a></li>
        </ul>
      </nav>
    {{end}}

    <section class="section content">
      <h1>Internet Access</h1>
      <article class="message is-info two-card-width">
        <div class="message-body">
          This is the full view of your internet settings. If it's too overwhelming, you can instead
          open the <a href="{{urlJoin (dict
            "path" .Meta.Path
            "query" (.Meta.Form.Without "mode").Encode
          )}}">simplified view</a> of this page.
        </div>
      </article>
      {{
        template "internet/status.advanced.partial.tmpl" dict
        "NetworkManager" .Data.NM
        "Meta" $.Meta
      }}
    </section>

    <section class="section content">
      <h2 id="internet_wifi">Wi-Fi</h2>
      <h3 id="internet_wifi_conn-profiles">Connection profiles</h3>
      <turbo-frame
        id="internet_wifi-conn-profiles"
        data-turbo-reload
        refresh="morph"
      >
        {{
          template "internet/conn-profiles-list.partial.tmpl" dict
          "ConnProfiles" .Data.WifiConnProfiles
          "Meta" .Meta
        }}
      </turbo-frame>
      <h3 id="internet_wifi_devices">Devices</h3>
      <turbo-frame
        id="internet_wifi-devices"
        data-turbo-reload
        refresh="morph"
      >
        {{range $device := .Data.WifiDevices}}
          {{
            template "internet/device-card.partial.tmpl" dict
            "Device" $device
            "CollapseAll" false
            "WithTurboStreamSource" true
            "Meta" $.Meta
          }}
        {{end}}
      </turbo-frame>
    </section>

    <section class="section content">
      <h2 id="internet_ethernet">Ethernet</h2>
      <h3 id="internet_ethernet_conn-profiles">Connection profiles</h3>
      <turbo-frame
        id="internet_ethernet-conn-profiles"
        data-turbo-reload
        refresh="morph"
      >
        {{
          template "internet/conn-profiles-list.partial.tmpl" dict
          "ConnProfiles" .Data.EthernetConnProfiles
          "Meta" .Meta
        }}
      </turbo-frame>
      <h3 id="internet_ethernet_devices">Devices</h3>
      <turbo-frame
        id="internet_ethernet-devices"
        data-turbo-reload
        refresh="morph"
      >
        {{range $device := .Data.EthernetDevices}}
          {{
            template "internet/device-card.partial.tmpl" dict
            "Device" $device
            "CollapseAll" false
            "WithTurboStreamSource" true
            "Meta" $.Meta
          }}
        {{end}}
      </turbo-frame>
    </section>

    <section class="section content">
      <h2 id="internet_other">Other network devices</h2>
      <p>
        Note: "bridge" and "<abbr title="virtual Ethernet">veth</abbr>" devices and connection
        profiles are not shown here.
      </p>
      <h3 id="internet_other_conn-profiles">Connection profiles</h3>
      <turbo-frame
        id="internet_other-conn-profiles"
        data-turbo-reload
        refresh="morph"
      >
        {{
          template "internet/conn-profiles-list.partial.tmpl" dict
          "ConnProfiles" .Data.OtherConnProfiles
          "Meta" .Meta
        }}
      </turbo-frame>
      <h3 id="internet_other_devices">Other network devices</h3>
      <turbo-frame
        id="internet_other-devices"
        data-turbo-reload
        refresh="morph"
      >
        {{range $device := .Data.OtherDevices}}
          {{$interface := or $device.IpInterface $device.ControlInterface}}
          {{$typeInfo := $device.Type.Info}}
          {{if or
            (eq $typeInfo.Short "bridge")
            (eq $typeInfo.Short "veth")
          }}
            {{continue}}
          {{end}}
          {{
            template "internet/device-card.partial.tmpl" dict
            "Device" $device
            "CollapseAll" true
            "Meta" $.Meta
          }}
        {{end}}
      </turbo-frame>
    </section>

    <!--
      TODO: display more information from https://networkmanager.pages.freedesktop.org/NetworkManager/NetworkManager/gdbus-org.freedesktop.NetworkManager.Settings.html,
      e.g. modifiability

    <section class="section content">
      <h2 id="internet_access-sharing">Internet access sharing</h2>
      <p>TODO: manage internet access sharing</p>
    </section>

    -->
  </main>
{{end}}
