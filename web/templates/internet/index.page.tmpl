{{if .Data.IsStreamPage}}
  {{template "shared/stream-page.layout.tmpl" .}}
{{else}}
  {{template "shared/base.layout.tmpl" .}}
{{end}}

{{define "title"}}Internet Access{{end}}
{{define "description"}}Manage configurations for internet access{{end}}

{{define "content"}}
  {{
    template "shared/turbo-cable-stream-source.partial.tmpl" dict
    "Name" (print .Meta.BasePath "internet")
    "BasePath" .Meta.BasePath
  }}

  <main class="main-container" tabindex="-1" data-controller="default-scrollable">
    {{if ne (.Meta.Form.Get "nav") "hidden"}}
      <nav class="breadcrumb main-breadcrumb" aria-label="breadcrumbs">
        <ul>
          <li><a href="{{urlJoin (dict
            "path" .Meta.BasePath
            "query" .Meta.Form.Encode
          )}}">Admin</a></li>
          <li class="is-active"><a href="{{urlJoin (dict
            "path" .Meta.Path
            "query" .Meta.Form.Encode
          )}}" aria-current="page">Internet</a></li>
        </ul>
      </nav>
    {{end}}

    <section class="section content">
      <h1>Internet Access</h1>
      <article class="message is-info two-card-width">
        <div class="message-body">
          This is a simplified view of your internet settings. If you're an experienced Linux system
          administrator, you can also open the
          <a href="{{urlJoin (dict
            "path" .Meta.Path
            "query" (.Meta.Form.WithInstead "mode" "advanced").Encode
          )}}">advanced view</a> of this page.
        </div>
      </article>
      {{
        template "internet/status.partial.tmpl" dict
        "NetworkManager" .Data.NM
        "Meta" $.Meta
      }}
    </section>

    <section class="section content">
      <h2 id="internet_wifi">Wi-Fi</h2>
      {{if not .Data.Wlan1InternetConnProfile.HasData}}
        <article class="message is-error two-card-width">
          <div class="message-body">
            The basic configuration file for internet access could not be found! Was it removed?
            You might be able to troubleshoot this by opening the
            <a href="{{urlJoin (dict
              "path" .Meta.Path
              "query" (.Meta.Form.WithInstead "mode" "advanced").Encode
            )}}">advanced view</a> of this page to check whether
            the "wlan1-internet" connection profile is listed, and if so, what its contents are.
            It should have ID "wlan1-internet" and be of type "wifi".
          </div>
        </article>
      {{else}}
        <h3>External Wi-Fi network</h3>
        <turbo-frame
          id="internet_wifi_external-network_no-device-message.frame"
          data-turbo-reload
        >
          {{if ne (or .Data.Wlan1Device.IpInterface .Data.Wlan1Device.ControlInterface) "wlan1"}}
            <article class="message is-warning two-card-width">
              <div class="message-body">
                No recognized USB Wi-Fi module is plugged into the machine! Such a module will be
                needed before this machine can connect to an external Wi-Fi network.
              </div>
            </article>
          {{end}}
        </turbo-frame>
        <div class="card section-card">
          <div class="card-content">
            {{
              template "internet/external-network-form.partial.tmpl" dict
              "ConnProfile" .Data.Wlan1InternetConnProfile
              "Device" .Data.Wlan1Device
              "AvailableSSIDs" .Data.AvailableSSIDs
              "Meta" .Meta
            }}
          </div>
        </div>
      {{end}}

      <h3 id="internet_wifi_devices">All modules</h3>
      <turbo-frame
        id="internet_wifi_devices.frame"
        data-turbo-reload
        refresh="morph"
      >
        {{range $device := .Data.WifiDevices}}
          {{
            template "internet/device-card.partial.tmpl" dict
            "Device" $device
            "Sections" (dict "basics" true)
            "CollapseAll" false
            "WithTurboStreamSource" true
            "Meta" $.Meta
          }}
        {{end}}
      </turbo-frame>
    </section>
    <section class="section content">
      <h2 id="internet_ethernet">Ethernet</h2>
      <h3 id="internet_ethernet_devices">All modules</h3>
      <turbo-frame
        id="internet_ethernet_devices.frame"
        data-turbo-reload
        refresh="morph"
      >
        {{range $device := .Data.EthernetDevices}}
          {{
            template "internet/device-card.partial.tmpl" dict
            "Device" $device
            "Sections" (dict "basics" true)
            "CollapseAll" false
            "WithTurboStreamSource" true
            "Meta" $.Meta
          }}
        {{end}}
      </turbo-frame>
    </section>
  </main>
{{end}}
