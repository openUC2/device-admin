{{if .Data.IsStreamPage}}
  {{template "shared/stream-page.layout.tmpl" .}}
{{else}}
  {{template "shared/base.layout.tmpl" .}}
{{end}}

{{define "title"}}Storage Drives{{end}}
{{define "description"}}Manage settings for data storage drives{{end}}

{{define "content"}}
  {{
    template "shared/turbo-cable-stream-source.partial.tmpl" dict
    "Name" (print .Meta.BasePath "storage")
    "BasePath" .Meta.BasePath
  }}

  <main class="main-container" tabindex="-1" data-controller="default-scrollable">
    {{if ne (.Meta.Form.Get "nav") "hidden"}}
      <nav class="breadcrumb main-breadcrumb" aria-label="breadcrumbs">
        <ul>
          <li><a href="{{urlJoin (dict
            "path" .Meta.BasePath
            "query" .Meta.Form.Encode
          )}}">Admin</a></li>
          <li class="is-active"><a href="{{urlJoin (dict
            "path" .Meta.Path
            "query" .Meta.Form.Encode
          )}}" aria-current="page">Storage</a></li>
        </ul>
      </nav>
    {{end}}

    <section class="section content">
      <h1>Storage Drives</h1>
    </section>

    <turbo-frame
      id="storage_removable-drives.frame"
      data-turbo-reload
      refresh="morph"
    >
      {{if gt (len .Data.RemovableDrives) 0}}
        <section class="section content">
          <h2>Removable drives</h2>
          <p>These devices are probably external USB drives.</p>
          {{range $drive := .Data.RemovableDrives}}
            {{
              template "storage/drive-card.partial.tmpl" dict
              "Drive" $drive
              "BlockDevices" (index $.Data.BlockDevices $drive.ID)
              "DiskUsages" (index $.Data.DiskUsages $drive.ID)
              "IsSystem" false
              "CollapseAll" false
              "Meta" $.Meta
            }}
          {{end}}
        </section>
      {{end}}
    </turbo-frame>

    <turbo-frame
      id="storage_system-drives.frame"
      data-turbo-reload
      refresh="morph"
    >
      <section class="section content">
        <h2>System drives</h2>
        <p>
          These devices are probably required for running the operating system. Don't unplug them!
        </p>
        {{range $drive := .Data.SystemDrives}}
          {{
            template "storage/drive-card.partial.tmpl" dict
            "Drive" $drive
            "BlockDevices" (index $.Data.BlockDevices $drive.ID)
            "DiskUsages" (index $.Data.DiskUsages $drive.ID)
            "IsSystem" true
            "CollapseAll" false
            "Meta" $.Meta
          }}
        {{else}}
          <p>(none detected!)</p>
        {{end}}
      </section>
    </turbo-frame>
  </main>
{{end}}
